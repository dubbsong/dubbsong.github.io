---
layout: post
title: "러닝 리액트(Learning React) - 웹팩"
categories: react
tags: react webpack
---

## Learning React - Alex Banks, Eve Porcello

<br>

## CHAPTER 05 JSX를 사용하는 리액트

<br>

### 5.4 웹팩 소개

> JSX와 ES6 이상의 트랜스파일링을 어떻게 처리해야 할까?

> 프로젝트의 의존관계를 어떻게 관리해야 할까?

> 이미지와 CSS를 어떻게 최적화할까?

- 이런 질문을 해결해주는 여러 도구가 있다. 브라우저리파이(Browserify), 걸프(Gulp), 그런트(Grunt), 웹팩(Webpack) 등이 대표 도구다.
- 웹팩은 모듈 번들러(module bundler)로 알려져 있다.
- 모듈 번들러는 여러 파일(JS, LESS, CSS, ES6 등)을 받아서 하나의 파일로 묶어준다.
- 모듈을 하나로 묶어서 얻는 두 가지 이익은 **모듈성(modularity)**과 **네트워크 성능(network performance)이다.
- 모듈성은 소스 코드를 작업하기 쉽게 여러 부분 또는 모듈로 나눠서 다룰 수 있게 해준다. 특히 팀 환경에서는 모듈성이 중요하다.
- 의존관계가 있는 여러 파일을 묶은 번들을 브라우저가 한 번만 읽어 들이기 때문에 네트워크 성능이 좋아진다.
- 각 script 태그는 HTTP 요청을 만들어내며, 그런 HTTP 요청마다 약간의 대기 시간(latency)이 발생한다.
- 모든 의존관계를 하나의 파일에 넣으면 단 한 번의 HTTP 요청으로 가져올 수 있으므로 추가 대기 시간을 방지할 수 있다.
- 트랜스파일링 외에 웹팩이 처리할 수 있는 일
  - 코드 분리
  - 코드 축소
  - 특징 켜고 끄기
  - HMR (hot module replacement)

<br>

#### 5.4.1 웹팩 로더

- **로더(loader)**는 빌드 과정에서 코드를 변환하는 방식을 처리하는 기능이다.
- 애플리케이션이 브라우저가 이해할 수 없는 다른 언어 등을 사용한다면 webpack.config.js에 필요한 로더를 지정해서 애플리케이션 코드를 브라우저가 이해할 수 있는 코드로 변환하게 만들어야 한다.
- 로더를 사용하는 가장 흔한 경우는 한 언어를 다른 언어로 트랜스파일링 하는 것이다.
  - babel-loader를 포함시키면 ES6나 리액트 코드를 트랜스파일링 할 수 있다.
- 로더를 사용하는 다른 경우는 페이지의 스타일을 바꾸는 것이다. css-loader는 .scss 확장자를 가진 파일을 찾아서 CSS 파일로 컴파일한다.

<br>

#### 5.4.2 웹팩 빌드를 사용한 조리법 앱

- 웹팩과 같은 도구를 사용해 클라이언트 JS를 미리 빌드하면 대규모 웹 애플리케이션을 여러 팀원이 함께 개발할 수 있다.
- 웹팩 모듈 번들러 사용의 이익
  - 모듈성
  - 조합
  - 속도
  - 일관성
- 웹팩 의존관계 설치
  - `sudo npm install -g webpack`
  - `npm install babel-core babel-loader babel-preset-env babel-preset-react babel-preset-stage-0 --save-dev`
  - `npm install react react-dom --save`
- 웹팩 설정
  - 웹팩의 디폴트 설정 파일 이름은 항상 webpack.config.js다.
  - 웹팩은 import 문을 발견할 때마다 파일시스템에서 해당 모듈을 찾아 번들에 포함시켜준다.
  - 웹팩은 import 트리를 쫓아가면서 필요한 모듈을 모두 번들에 넣어준다.
  - webpack.config.js 파일은 웹팩이 취해야 하는 동작을 기술하는 JS 리터럴 객체를 외부에 export하는 단순한 모듈에 불과하다.
  - index.js 파일이 위치한 프로젝트의 루트 폴더에 webpack.config.js 파일을 만들어야 한다.
  - 우선 웹팩에 클라이언트의 시작 파일이 `./src/index.js`라는 사실을 지정한다.
  - 웹팩은 `index.js` 파일 안에 있는 import 문부터 시작해서 모든 의존관계 트리를 자동으로 빌드해준다.
  - rules 필드는 웹팩으로 적용할 수 있는 다양한 유형의 로더를 처리해야 하기 때문에 배열이다.
  - 각각의 로더는 JS 객체다.
  - test 필드는 로더가 처리해야 하는 모듈의 파일 경로를 매치시켜주는 정규식이다.
  - 웹팩은 성공하면 번들을 만들고 실패하면 오류 메시지를 표시한다.
  - 대부분의 오류는 import 참조가 잘못된 경우에 발생한다.
  - 웹팩 오류를 디버깅할 때는 import 문에 사용한 파일 이름과 경로를 자세히 살펴봐야 한다.
- 번들 로딩하기
  - 웹팩은 번들을 dist 폴더에 넣는다.
  - 이 폴더에 index.html 파일을 넣어야 한다.
- 소스 매핑
  - 코드를 하나의 번들 파일로 만들면 브라우저에서 앱을 디버깅할 때 약간 곤란해진다. 이런 문제는 소스 맵을 제공하여 해결할 수 있다.
  - 웹팩은 번들을 export하면서 소스 맵과 번들 사이의 연관관계를 맺어준다.
  - 다시 웹팩을 실행하면 assets 폴더에 bundle.js와 bundle.map이라는 파일이 생긴다.
- 번들 최적화하기
  - 파일에 들어 있는 텍스트의 양을 줄이면 파일 크기가 줄고 그에 따라 HTTP 전송을 통한 번들 로딩도 더 빨라진다.
  - 이런 기법을 활용해 JS 파일의 크기를 줄이는 작업을 **축소(minifying)** 또는 **난독화(uglifying)**라고 부른다.
  - UglifyJsPlugin은 인자로부터 처리 방법에 대한 지시를 받는 함수다.
  - 난독화하면 코드를 알아볼 수 없으므로 원본과 난독화 이후 코드를 연결해주는 소스 맵이 필요하다. 따라서 sourceMap을 true로 설정한다.
- create-react-app
  - 개발자가 직접 웹팩, 바벨, ESLint 등 여러 도구의 설정을 손보지 않아도 빠르게 리액트 프로젝트를 시작할 수 있게 해준다.
  - create-react-app 명령은 리액트 프로젝트를 해당 디렉토리에 만들면서 React, ReactDOM, react-scripts에 대한 의존관계를 설정해준다.
  - 생성된 프로젝트 폴더 안에는 App.js 파일이 들어 있는 src 폴더가 있다.
  - App.js 파일이 루트 컴포넌트이므로 그 파일을 열어서 다른 컴포넌트 파일을 import하면 된다.
  - yarn build 명령은 트렌스파일링과 축소를 거친 프로덕션에 사용할 수 있는 번들을 만든다.

<br>

